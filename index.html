<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LANTANA BLD. ãƒ•ãƒ­ã‚¢ã‚¬ã‚¤ãƒ‰</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Space+Mono:wght@400;700&display=swap');
  :root {
    --bg: #f5f2ee; --panel: #ede9e3; --border: #a89880;
    --accent: #0d2444; --text: #0d0d0d; --muted: #3a3028;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans JP', sans-serif;
    height: 100vh;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* â”€â”€ Header â”€â”€ */
  header {
    padding: 10px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(245,242,238,0.97);
    backdrop-filter: blur(10px);
    z-index: 10;
    flex-shrink: 0;
  }
  .logo { font-family: 'Space Mono', monospace; font-size: 16px; color: var(--accent); letter-spacing: 2px; }
  .subtitle { font-size: 10px; color: var(--muted); letter-spacing: 1px; }

  /* â”€â”€ Main layout: PC = æ¨ªä¸¦ã³ã€SP = ç¸¦ä¸¦ã³ â”€â”€ */
  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
    flex-direction: row; /* PC */
  }

  /* â”€â”€ 3D canvas â”€â”€ */
  #canvas-container {
    flex: 1;
    position: relative;
    cursor: grab;
    min-height: 0;
  }
  #canvas-container:active { cursor: grabbing; }
  canvas { display: block; width: 100% !important; height: 100% !important; }

  /* â”€â”€ Hint â”€â”€ */
  .hint {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    background: rgba(245,242,238,0.9);
    padding: 5px 12px;
    border: 1px solid var(--border);
    border-radius: 20px;
    letter-spacing: 1px;
    pointer-events: none;
    white-space: nowrap;
  }

  /* â”€â”€ Sidebar: PC = å³å´ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« â”€â”€ */
  .sidebar {
    width: 300px;
    border-left: 1px solid var(--border);
    overflow-y: auto;
    overflow-x: hidden;
    background: var(--panel);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
  }
  .sidebar-header {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--accent);
    letter-spacing: 2px;
    flex-shrink: 0;
  }

  /* â”€â”€ Floor cards â”€â”€ */
  .floor-card {
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.2s;
    padding: 12px 16px;
  }
  .floor-card:hover { background: rgba(26,58,107,0.05); }
  .floor-card.active { background: rgba(26,58,107,0.08); border-left: 3px solid var(--accent); }
  .floor-num { font-family: 'Space Mono', monospace; font-size: 20px; font-weight: 700; line-height: 1; margin-bottom: 4px; }
  .floor-name { font-size: 12px; font-weight: 700; margin-bottom: 4px; }
  .floor-items { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
  .tag { font-size: 9px; padding: 2px 7px; border-radius: 10px; background: rgba(0,0,0,0.05); color: var(--muted); border: 1px solid var(--border); }
  .floor-area { font-family: 'Space Mono', monospace; font-size: 9px; color: var(--muted); margin-top: 5px; }
  .color-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; vertical-align: middle; }

  .sidebar::-webkit-scrollbar { width: 4px; }
  .sidebar::-webkit-scrollbar-track { background: var(--panel); }
  .sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* PC: floors-scroll ã¯1åˆ—ç¸¦ä¸¦ã³ */
  .floors-scroll {
    display: flex;
    flex-direction: column;
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SP: 768pxä»¥ä¸‹
     3Dãƒ“ãƒ¥ãƒ¼ä¸Šéƒ¨ 55dvh ï¼‹ ãƒ•ãƒ­ã‚¢ã‚«ãƒ¼ãƒ‰ä¸‹éƒ¨ 2åˆ—ã‚°ãƒªãƒƒãƒ‰
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  @media (max-width: 768px) {
    body { height: 100dvh; }

    .main { flex-direction: column; }

    #canvas-container {
      height: 55dvh;
      flex: none;
    }

    /* SPç”¨ãƒ’ãƒ³ãƒˆ */
    .hint-pc { display: none; }
    .hint-sp { display: block; }

    .sidebar {
      width: 100%;
      flex: 1;
      border-left: none;
      border-top: 1px solid var(--border);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header { padding: 6px 12px; font-size: 9px; flex-shrink: 0; }

    /* 2åˆ—ã‚°ãƒªãƒƒãƒ‰ */
    .floors-scroll {
      display: grid !important;
      grid-template-columns: 1fr 1fr;
      overflow-x: hidden;
      overflow-y: auto;
      flex: 1;
      gap: 0;
    }

    .floor-card {
      min-width: unset;
      max-width: unset;
      border-bottom: 1px solid var(--border);
      border-right: 1px solid var(--border);
      flex-shrink: unset;
      scroll-snap-align: unset;
      padding: 8px 10px;
    }
    .floor-card.active {
      border-left: none;
      border-top: 3px solid var(--accent);
      background: rgba(26,58,107,0.08);
    }
    .floor-num { font-size: 16px; }
    .floor-name { font-size: 11px; }
    .floor-area { font-size: 8px; }
    .tag { font-size: 8px; padding: 1px 5px; }
  }

  /* â”€â”€ ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ â”€â”€ */
  @media (max-width: 1024px) and (min-width: 769px) {
    .sidebar { width: 240px; }
    .logo { font-size: 14px; }
  }

  /* PCç”¨ãƒ’ãƒ³ãƒˆï¼SPç”¨ãƒ’ãƒ³ãƒˆ åˆæœŸçŠ¶æ…‹ */
  .hint-sp { display: none; }

  /* â”€â”€ æ“ä½œãƒœã‚¿ãƒ³ï¼ˆå³ä¸‹ï¼‰ â”€â”€ */
  .controls {
    position: absolute;
    right: 14px;
    bottom: 14px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 5;
  }
  .ctrl-group {
    display: flex;
    flex-direction: column;
    gap: 2px;
    background: rgba(245,242,238,0.92);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    backdrop-filter: blur(6px);
  }
  .ctrl-btn {
    width: 36px;
    height: 36px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 16px;
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    border-bottom: 1px solid var(--border);
    user-select: none;
    -webkit-user-select: none;
  }
  .ctrl-btn:last-child { border-bottom: none; }
  .ctrl-btn:hover, .ctrl-btn:active { background: rgba(13,46,90,0.1); }
  .ctrl-btn.active-toggle { background: rgba(13,46,90,0.15); color: var(--accent2, #8b1a10); }
  .ctrl-divider {
    height: 1px;
    background: var(--border);
    margin: 0;
  }
</style>
</head>
<body>
<header>
  <div>
    <div class="logo">LANTANA BLD.</div>
    <div class="subtitle">ãƒ•ãƒ­ã‚¢ã‚¬ã‚¤ãƒ‰</div>
  </div>
</header>
<div class="main">
  <div id="canvas-container">
    <canvas id="c"></canvas>
    <!-- ã‚°ãƒ­ãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ç”¨canvas -->
    <canvas id="glow-canvas" style="position:absolute;top:0;left:0;pointer-events:none;width:100%;height:100%;"></canvas>
    <div class="hint hint-pc">ğŸ–± ãƒ‰ãƒ©ãƒƒã‚°ã§å›è»¢ ï¼ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ </div>
    <div class="hint hint-sp">ğŸ‘† ãƒ‰ãƒ©ãƒƒã‚°ã§å›è»¢ ï¼ ãƒ”ãƒ³ãƒã§ã‚ºãƒ¼ãƒ </div>

    <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
    <div class="controls">
      <!-- ã‚ºãƒ¼ãƒ  -->
      <div class="ctrl-group">
        <button class="ctrl-btn" id="btn-zoom-in"  title="ã‚ºãƒ¼ãƒ ã‚¤ãƒ³">ï¼‹</button>
        <button class="ctrl-btn" id="btn-zoom-out" title="ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ">ï¼</button>
      </div>
      <!-- å›è»¢ -->
      <div class="ctrl-group">
        <button class="ctrl-btn" id="btn-rot-up"    title="ä¸Šã¸">â–²</button>
        <button class="ctrl-btn" id="btn-rot-left"  title="å·¦ã¸">â—€</button>
        <button class="ctrl-btn" id="btn-rot-right" title="å³ã¸">â–¶</button>
        <button class="ctrl-btn" id="btn-rot-down"  title="ä¸‹ã¸">â–¼</button>
      </div>
      <!-- ãƒªã‚»ãƒƒãƒˆ -->
      <div class="ctrl-group">
        <button class="ctrl-btn active-toggle" id="btn-autorot" title="è‡ªå‹•å›è»¢ON/OFF">
          <svg id="autorot-icon" viewBox="0 0 16 16" width="14" height="14" fill="currentColor">
            <polygon points="3,2 13,8 3,14"/>
          </svg>
        </button>
        <button class="ctrl-btn" id="btn-reset" title="ãƒªã‚»ãƒƒãƒˆ">âŸ³</button>
      </div>
    </div>
  </div>
  <div class="sidebar">
    <div class="sidebar-header">FLOOR INFORMATION</div>
    <div class="floors-scroll">
    <div class="floor-card active" data-floor="1" onclick="selectFloor(1)">
      <div class="floor-num"><span class="color-dot" style="background:#8b1a10"></span>1F</div>
      <div class="floor-name">LANTANA é£Ÿå ‚ ï¼ COFFEE STAND</div>
      <div class="floor-items">
        <span class="tag">é£²é£Ÿåº—</span>
        <span class="tag">ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰</span>
        <span class="tag">å¨æˆ¿</span>
        <span class="tag">å€‰åº«</span>
        <span class="tag">WC</span>
      </div>
      <div class="floor-area">å»¶åºŠé¢ç© ç´„ 99mÂ²</div>
    </div>
    <div class="floor-card" data-floor="2" onclick="selectFloor(2)">
      <div class="floor-num"><span class="color-dot" style="background:#7a3c00"></span>2F</div>
      <div class="floor-name">LANTANA CAPSULE HOTEL</div>
      <div class="floor-items"><span class="tag">å®¢å®¤ 1ã€œ6å·å®¤</span><span class="tag">å—ä»˜</span><span class="tag">ã‚¹ã‚¿ãƒƒãƒ•ãƒ«ãƒ¼ãƒ </span><span class="tag">ã‚·ãƒ£ãƒ¯ãƒ¼å®¤</span><span class="tag">WC</span></div>
      <div class="floor-area">33.98ã¡ï¼ˆå®¿æ³Šã‚¨ãƒªã‚¢ï¼‰ï¼ 12å</div>
    </div>
    <div class="floor-card" data-floor="3" onclick="selectFloor(3)">
      <div class="floor-num"><span class="color-dot" style="background:#145a32"></span>3F</div>
      <div class="floor-name">LANTANA CAPSULE HOTEL</div>
      <div class="floor-items"><span class="tag">å®¢å®¤ 1ã€œ14å·å®¤</span><span class="tag">ãƒ©ãƒ³ãƒ‰ãƒªãƒ¼</span><span class="tag">å€‰åº«</span><span class="tag">MWC</span></div>
      <div class="floor-area">57.35ã¡ï¼ˆå®¿æ³Šã‚¨ãƒªã‚¢ï¼‰ï¼ 28å</div>
    </div>
    <div class="floor-card" data-floor="4" onclick="selectFloor(4)">
      <div class="floor-num"><span class="color-dot" style="background:#0d2e5a"></span>4F</div>
      <div class="floor-name">LANTANA STUDY ROOM</div>
      <div class="floor-items"><span class="tag">è‡ªç¿’å®¤ 18å</span><span class="tag">ä¼‘æ†©å®¤</span><span class="tag">MWC</span></div>
      <div class="floor-area">è‡ªç¿’å®¤ 39.49ã¡ ï¼ ä¼‘æ†©å®¤ 30.93ã¡</div>
    </div>
    <div class="floor-card" data-floor="5" onclick="selectFloor(5)">
      <div class="floor-num"><span class="color-dot" style="background:#4a1060"></span>5F</div>
      <div class="floor-name">LANTANA RESIDENCE</div>
      <div class="floor-items"><span class="tag">ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ«ãƒ¼ãƒ  1</span><span class="tag">ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ«ãƒ¼ãƒ  2</span></div>
      <div class="floor-area">ãƒ«ãƒ¼ãƒ 1 20.61ã¡ ï¼ ãƒ«ãƒ¼ãƒ 2 25.12ã¡</div>
    </div>
    </div><!-- /.floors-scroll -->
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" crossorigin="anonymous"></script>
<script>
/* ============================================================
   LANTANA BLD. ãƒ•ãƒ­ã‚¢ã‚¬ã‚¤ãƒ‰ â€” ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   æ§‹æˆï¼š
     1. ã‚·ãƒ¼ãƒ³ãƒ»ã‚«ãƒ¡ãƒ©ãƒ»ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–
     2. å®šæ•°ãƒ»ã‚«ãƒ©ãƒ¼å®šç¾©
     3. ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ æç”»ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
     4. å®¶å…·ãƒ»äººç‰©ã®3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆé–¢æ•°
     5. å„éšã®å®¶å…·ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ1Fã€œ5Fï¼‰
     6. ãƒ•ãƒ­ã‚¢æœ¬ä½“ï¼ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒœãƒƒã‚¯ã‚¹ï¼‹ã‚¹ãƒ©ãƒ–ï¼‰ã®ç”Ÿæˆ
     7. ã‚°ãƒ­ãƒ¼ç”¨ã‚·ãƒ¼ãƒ³ç”Ÿæˆ
     8. ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
     9. ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒæ“ä½œï¼ˆãƒ‰ãƒ©ãƒƒã‚°å›è»¢ï¼ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚ºãƒ¼ãƒ ï¼ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼‰
    10. ãƒ•ãƒ­ã‚¢é¸æŠï¼ˆã‚«ãƒ¡ãƒ©ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ï¼‹ã‚°ãƒ­ãƒ¼åˆ‡æ›¿ï¼‰
    11. è¡¨ç¤ºåˆ‡æ›¿ï¼ˆé¸æŠéšï¼šãƒ•ãƒ­ã‚¢ã‚«ãƒ©ãƒ¼ã€éé¸æŠï¼šã‚°ãƒ¬ãƒ¼ï¼‰
    12. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆlerpè£œé–“ã‚«ãƒ¡ãƒ©ï¼‹ç‚¹æ»…ã‚°ãƒ­ãƒ¼ï¼‰
    13. æ“ä½œãƒœã‚¿ãƒ³ï¼ˆã‚ºãƒ¼ãƒ ï¼å›è»¢ï¼ãƒªã‚»ãƒƒãƒˆï¼è‡ªå‹•å›è»¢ãƒˆã‚°ãƒ«ï¼‰
============================================================ */


/* ============================================================
   1. ã‚·ãƒ¼ãƒ³ãƒ»ã‚«ãƒ¡ãƒ©ãƒ»ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–
============================================================ */
const container  = document.getElementById('canvas-container');
const canvas     = document.getElementById('c');
const glowCanvas = document.getElementById('glow-canvas');

// ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ï¼ˆå»ºç‰©ãƒ»å®¶å…·ã‚’æç”»ï¼‰
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
renderer.setPixelRatio(window.devicePixelRatio);

// ã‚°ãƒ­ãƒ¼å°‚ç”¨ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
// é¸æŠéšã®å¤–å½¢ãƒ©ã‚¤ãƒ³ã®ã¿åˆ¥ã‚·ãƒ¼ãƒ³ã«æç”» â†’ CSS blur/brightness ã§ã‚°ãƒ­ãƒ¼æ¼”å‡º
const glowRenderer = new THREE.WebGLRenderer({ canvas: glowCanvas, antialias: true, alpha: true });
glowRenderer.setPixelRatio(window.devicePixelRatio);
glowRenderer.setClearColor(0x000000, 0); // é€æ˜èƒŒæ™¯

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf5f2ee); // ãƒšãƒ¼ã‚¸èƒŒæ™¯è‰²ã¨åˆã‚ã›ã‚‹

// é€è¦–æŠ•å½±ã‚«ãƒ¡ãƒ©ï¼ˆè¦–é‡è§’45Â°ï¼‰
const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);


/* ============================================================
   2. å®šæ•°ãƒ»ã‚«ãƒ©ãƒ¼å®šç¾©
============================================================ */

// ã‚¹ã‚±ãƒ¼ãƒ«: 1 Three.jsãƒ¦ãƒ‹ãƒƒãƒˆ = 2m
const SCALE = 0.5;

// å»ºç‰©å¯¸æ³•ï¼ˆå®Ÿå¯¸ Ã— SCALEï¼‰
const W  = 14.1 * SCALE;  // ä¸»æ£Ÿï¼šå¹…
const D  = 6.65 * SCALE;  // ä¸»æ£Ÿï¼šå¥¥è¡Œã
const FH = 3.5  * SCALE;  // éšé«˜
const AW = 7.5  * SCALE;  // ã‚¢ãƒãƒƒã‚¯ã‚¹ï¼šå¹…ï¼ˆ1ã€œ3Fï¼‰
const AD = 2.2  * SCALE;  // ã‚¢ãƒãƒƒã‚¯ã‚¹ï¼šå¥¥è¡Œã

// å„éšã®ãƒ¯ã‚¤ãƒ¤ãƒ¼è‰²ï¼ˆé¸æŠæ™‚ï¼‰
const floorColors = {
  1: 0x8b1a10, // 1F: æ·±èµ¤ï¼ˆé£Ÿå ‚ï¼‰
  2: 0x7a3c00, // 2F: ç„¦èŒ¶ï¼ˆã‚«ãƒ—ã‚»ãƒ«ï¼‰
  3: 0x145a32, // 3F: æ·±ç·‘ï¼ˆã‚«ãƒ—ã‚»ãƒ«ï¼‰
  4: 0x0d2e5a, // 4F: ç´ºï¼ˆå­¦ç¿’å®¤ï¼‰
  5: 0x4a1060  // 5F: æ·±ç´«ï¼ˆãƒ¬ã‚¸ãƒ‡ãƒ³ã‚¹ï¼‰
};

// å„éšãƒ•ãƒ­ã‚¢ã‚¹ãƒ©ãƒ–ã®å¡—ã‚Šè‰²ï¼ˆé¸æŠæ™‚ãƒ»è–„ã„ï¼‰
const floorColorsLight = {
  1: 0xf5c8c0,
  2: 0xf5dfc0,
  3: 0xc8e8d5,
  4: 0xc8d8f0,
  5: 0xe0c8f5
};

// å„éšã®ã‚°ãƒ­ãƒ¼ç™ºå…‰è‰²ï¼ˆæ˜ã‚‹ã‚ã®è£œè‰²ç³»ï¼‰
const floorGlowColors = {
  1: 0xff6050, // 1F: æ˜ã‚‹ã„èµ¤
  2: 0xff9050, // 2F: æ˜ã‚‹ã„ã‚ªãƒ¬ãƒ³ã‚¸
  3: 0x50ff90, // 3F: æ˜ã‚‹ã„ç·‘
  4: 0x5090ff, // 4F: æ˜ã‚‹ã„é’
  5: 0xcc60ff  // 5F: æ˜ã‚‹ã„ç´«
};

// éé¸æŠæ™‚ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼è‰²ï¼ˆã‚°ãƒ¬ãƒ¼ç³»ï¼‰
const GRAY      = new THREE.Color(0x888888);
const GRAY_SLAB = new THREE.Color(0xbbbbbb);

// ç¾åœ¨é¸æŠä¸­ã®éšç•ªå·
let selectedFloor = 1;

// å„éšã®Three.jsã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ ¼ç´ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
const floorGroups     = {}; // å»ºç‰©æœ¬ä½“ï¼ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒœãƒƒã‚¯ã‚¹ï¼‹ã‚¹ãƒ©ãƒ–ï¼‰
const furnitureGroups = {}; // å®¶å…·ãƒ»äººç‰©ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ


/* ============================================================
   3. ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ æç”»ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
   ã™ã¹ã¦ã®å®¶å…·ãƒ»å»ºç‰©ã‚’ã“ã®2é–¢æ•°ã§çµ±ä¸€ã—ã¦æç”»ã™ã‚‹
============================================================ */

/**
 * ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒœãƒƒã‚¯ã‚¹ï¼ˆç›´æ–¹ä½“ã®ã‚¨ãƒƒã‚¸ãƒ©ã‚¤ãƒ³ï¼‰ã‚’ç”Ÿæˆ
 * @param {number} w,h,d - å¹…ãƒ»é«˜ã•ãƒ»å¥¥è¡Œã
 * @param {number} color  - 0xRRGGBB å½¢å¼ã®ã‚«ãƒ©ãƒ¼
 * @param {number} x,y,z  - é…ç½®åº§æ¨™
 * @param {number} op     - é€æ˜åº¦ï¼ˆ0ã€œ1ï¼‰
 */
function wBox(w, h, d, color, x, y, z, op = 0.9) {
  const mesh = new THREE.LineSegments(
    new THREE.EdgesGeometry(new THREE.BoxGeometry(w, h, d)),
    new THREE.LineBasicMaterial({ color, transparent: true, opacity: op })
  );
  mesh.position.set(x, y, z);
  return mesh;
}

/**
 * ãƒ¯ã‚¤ãƒ¤ãƒ¼ã‚·ãƒªãƒ³ãƒ€ãƒ¼ï¼ˆå††æŸ±ã®ã‚¨ãƒƒã‚¸ãƒ©ã‚¤ãƒ³ï¼‰ã‚’ç”Ÿæˆ
 * @param {number} rt  - åŠå¾„
 * @param {number} h   - é«˜ã•
 * @param {number} seg - åˆ†å‰²æ•°ï¼ˆå¤šã„ã»ã©æ»‘ã‚‰ã‹ï¼‰
 */
function wCyl(rt, h, seg, color, x, y, z, op = 0.9) {
  const mesh = new THREE.LineSegments(
    new THREE.EdgesGeometry(new THREE.CylinderGeometry(rt, rt, h, seg)),
    new THREE.LineBasicMaterial({ color, transparent: true, opacity: op })
  );
  mesh.position.set(x, y, z);
  return mesh;
}

/**
 * MeshBasicMaterial ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒœãƒƒã‚¯ã‚¹ï¼ˆæ—§å½¢å¼ãƒ»å»ºç‰©å¤–å½¢ã«ä½¿ç”¨ï¼‰
 * wBox ã¨ç•°ãªã‚Š MeshBasicMaterial.wireframe ã‚’ä½¿ã†ãŸã‚ã€
 * updateVisibility ã§ child.material.wireframe ã§è­˜åˆ¥ã§ãã‚‹
 */
function wireBox(w, h, d, color, x, y, z, opacity = 1) {
  const mesh = new THREE.Mesh(
    new THREE.BoxGeometry(w, h, d),
    new THREE.MeshBasicMaterial({ color, wireframe: true, transparent: true, opacity })
  );
  mesh.position.set(x, y, z);
  return mesh;
}


/* ============================================================
   4. å®¶å…·ãƒ»äººç‰©ã®3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆé–¢æ•°
   ã™ã¹ã¦ wBox / wCyl ã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ã®ã¿ã§æ§‹æˆ
   è‰²ã¯å‘¼ã³å‡ºã—å…ƒã‹ã‚‰ floorColors[f] ã‚’æ¸¡ã—ã¦éšã”ã¨ã«çµ±ä¸€
============================================================ */

/** äººç‰©ï¼ˆé ­ãƒ»èƒ´ãƒ»è„šã®ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ–ãƒ­ãƒƒã‚¯ï¼‰ */
function makePerson(color, x, y, z) {
  const g = new THREE.Group();
  const s = 0.18; // ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚º
  g.add(wBox(s,        s * 1.3, s * 0.7, color, 0,       s * 0.7,  0)); // èƒ´ä½“
  g.add(wBox(s * 0.85, s * 0.85, s * 0.85, color, 0,     s * 1.6,  0)); // é ­
  g.add(wBox(s * 0.3,  s * 0.75, s * 0.3,  color, -s * 0.2, 0,     0)); // å·¦è„š
  g.add(wBox(s * 0.3,  s * 0.75, s * 0.3,  color,  s * 0.2, 0,     0)); // å³è„š
  g.position.set(x, y, z);
  return g;
}

/** ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¤©æ¿ï¼‹4æœ¬è„šï¼‰ */
function makeTable(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.7,  0.05, 0.45, color,  0,     0.35,  0));   // å¤©æ¿
  g.add(wBox(0.04, 0.34, 0.04, color, -0.3,   0.17, -0.18)); // è„šÃ—4
  g.add(wBox(0.04, 0.34, 0.04, color,  0.3,   0.17, -0.18));
  g.add(wBox(0.04, 0.34, 0.04, color, -0.3,   0.17,  0.18));
  g.add(wBox(0.04, 0.34, 0.04, color,  0.3,   0.17,  0.18));
  g.position.set(x, y, z);
  return g;
}

/** æ¤…å­ï¼ˆåº§é¢ï¼‹èƒŒã‚‚ãŸã‚Œï¼‹4æœ¬è„šï¼‰
 * @param {number} rotY - å‘ãï¼ˆãƒ©ã‚¸ã‚¢ãƒ³ï¼‰
 */
function makeChair(color, x, y, z, rotY = 0) {
  const g = new THREE.Group();
  g.add(wBox(0.35, 0.04, 0.35, color,  0,     0.22,  0));    // åº§é¢
  g.add(wBox(0.35, 0.38, 0.04, color,  0,     0.42, -0.15)); // èƒŒã‚‚ãŸã‚Œ
  g.add(wBox(0.04, 0.22, 0.04, color, -0.14,  0.11, -0.14)); // è„šÃ—4
  g.add(wBox(0.04, 0.22, 0.04, color,  0.14,  0.11, -0.14));
  g.add(wBox(0.04, 0.22, 0.04, color, -0.14,  0.11,  0.14));
  g.add(wBox(0.04, 0.22, 0.04, color,  0.14,  0.11,  0.14));
  g.rotation.y = rotY;
  g.position.set(x, y, z);
  return g;
}

/** ã‚«ãƒ—ã‚»ãƒ«ãƒ™ãƒƒãƒ‰ï¼ˆã‚·ã‚§ãƒ«ï¼‹ãƒãƒƒãƒˆãƒ¬ã‚¹ï¼‹æ•ï¼‰ */
function makeCapsuleBed(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.9,  0.5,  0.5,  color,  0,     0.25,  0));    // å¤–æ®»
  g.add(wBox(0.85, 0.05, 0.38, color,  0,     0.06,  0.02)); // ãƒãƒƒãƒˆãƒ¬ã‚¹
  g.add(wBox(0.22, 0.05, 0.3,  color, -0.28,  0.12,  0.02)); // æ•
  g.position.set(x, y, z);
  return g;
}

/** å—ä»˜ãƒ»ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆæœ¬ä½“ï¼‹å¤©æ¿ï¼‰ */
function makeCounter(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(1.2, 0.8,  0.45, color, 0, 0.4,  0)); // æœ¬ä½“
  g.add(wBox(1.2, 0.04, 0.55, color, 0, 0.82, 0)); // å¤©æ¿ï¼ˆå¼µã‚Šå‡ºã—ï¼‰
  g.position.set(x, y, z);
  return g;
}

/** å­¦ç¿’ãƒ‡ã‚¹ã‚¯ï¼ˆå¤©æ¿ï¼‹4æœ¬è„šï¼‹ãƒ¢ãƒ‹ã‚¿ãƒ¼ï¼‹ã‚¹ã‚¿ãƒ³ãƒ‰ï¼‰ */
function makeDesk(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.65, 0.04, 0.4,  color,  0,    0.32,  0));    // å¤©æ¿
  g.add(wBox(0.04, 0.32, 0.04, color, -0.3,  0.16, -0.18)); // è„šÃ—4
  g.add(wBox(0.04, 0.32, 0.04, color,  0.3,  0.16, -0.18));
  g.add(wBox(0.04, 0.32, 0.04, color, -0.3,  0.16,  0.18));
  g.add(wBox(0.04, 0.32, 0.04, color,  0.3,  0.16,  0.18));
  g.add(wBox(0.3,  0.2,  0.03, color,  0,    0.52, -0.16)); // ãƒ¢ãƒ‹ã‚¿ãƒ¼ç”»é¢
  g.add(wBox(0.05, 0.08, 0.05, color,  0,    0.36, -0.14)); // ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰
  g.position.set(x, y, z);
  return g;
}

/** ã‚½ãƒ•ã‚¡ï¼ˆåº§é¢ï¼‹èƒŒã‚‚ãŸã‚Œï¼‹ã‚¢ãƒ¼ãƒ ãƒ¬ã‚¹ãƒˆÃ—2ï¼‰ */
function makeSofa(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(1.0,  0.18, 0.5,  color,  0,     0.09,  0));    // åº§é¢
  g.add(wBox(1.0,  0.28, 0.16, color,  0,     0.32, -0.17)); // èƒŒã‚‚ãŸã‚Œ
  g.add(wBox(0.15, 0.26, 0.5,  color, -0.42,  0.22,  0));    // å·¦ã‚¢ãƒ¼ãƒ ãƒ¬ã‚¹ãƒˆ
  g.add(wBox(0.15, 0.26, 0.5,  color,  0.42,  0.22,  0));    // å³ã‚¢ãƒ¼ãƒ ãƒ¬ã‚¹ãƒˆ
  g.position.set(x, y, z);
  return g;
}

/** æ´—æ¿¯æ©Ÿï¼ˆæœ¬ä½“ï¼‹ãƒ‰ã‚¢å††å½¢ï¼‰ */
function makeWasher(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.38, 0.42, 0.4,  color, 0, 0.21,  0));   // æœ¬ä½“
  g.add(wCyl(0.11, 0.04, 12,   color, 0, 0.33,  0.21)); // æ­£é¢ã®ä¸¸ãƒ‰ã‚¢
  g.position.set(x, y, z);
  return g;
}

/** è¦³è‘‰æ¤ç‰©ï¼ˆé‰¢ï¼‹è‘‰ã‚’å††æŸ±ã§è¡¨ç¾ï¼‰ */
function makePlant(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wCyl(0.12, 0.22, 6, color,  0,    0.11, 0));      // é‰¢
  g.add(wCyl(0.18, 0.28, 5, color,  0,    0.35, 0));      // è‘‰ï¼ˆä¸­å¤®ï¼‰
  g.add(wCyl(0.12, 0.2,  5, color,  0.1,  0.42, 0.05));  // è‘‰ï¼ˆå³ï¼‰
  g.position.set(x, y, z);
  return g;
}

/** ã‚³ãƒ¼ãƒ’ãƒ¼ãƒã‚·ãƒ³ï¼ˆæœ¬ä½“ï¼‹ä¸Šéƒ¨ï¼‹ãƒã‚ºãƒ«ï¼‰ */
function makeCoffeeMachine(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.3,  0.44, 0.28, color, 0, 0.22, 0));    // æœ¬ä½“
  g.add(wBox(0.18, 0.05, 0.18, color, 0, 0.46, 0));    // ä¸Šéƒ¨ãƒ—ãƒ¬ãƒ¼ãƒˆ
  g.add(wCyl(0.05, 0.12, 6,    color, 0, 0.34, 0.15)); // ãƒã‚ºãƒ«ï¼ˆå‰é¢ï¼‰
  g.position.set(x, y, z);
  return g;
}

/** æœ¬æ£šï¼ˆå¤–æ ï¼‹æ£šæ¿Ã—3ï¼‰ */
function makeBookshelf(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.76, 0.9,  0.32, color, 0, 0.45, 0)); // å¤–æ 
  g.add(wBox(0.74, 0.04, 0.3,  color, 0, 0.0,  0)); // æ£šæ¿ï¼ˆä¸‹ï¼‰
  g.add(wBox(0.74, 0.04, 0.3,  color, 0, 0.3,  0)); // æ£šæ¿ï¼ˆä¸­ï¼‰
  g.add(wBox(0.74, 0.04, 0.3,  color, 0, 0.6,  0)); // æ£šæ¿ï¼ˆä¸Šï¼‰
  g.position.set(x, y, z);
  return g;
}

/** ãƒãƒ¼ãƒˆPCï¼ˆæœ¬ä½“ï¼‹ç”»é¢ï¼‰ */
function makeLaptop(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.34, 0.02, 0.24, color, 0, 0.01,  0));   // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰é¢
  const screen = wBox(0.32, 0.2, 0.02, color, 0, 0.12, -0.11); // ç”»é¢
  screen.rotation.x = -0.3; // å°‘ã—é–‹ã„ãŸè§’åº¦
  g.add(screen);
  g.position.set(x, y, z);
  return g;
}

/** ãƒ™ãƒƒãƒ‰ï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ï¼‹ãƒãƒƒãƒˆãƒ¬ã‚¹ï¼‹æ•ï¼‹ãƒ˜ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ï¼‰ */
function makeBed(color, x, y, z) {
  const g = new THREE.Group();
  g.add(wBox(0.9,  0.18, 1.8,  color, 0, 0.09,  0));    // ãƒ•ãƒ¬ãƒ¼ãƒ 
  g.add(wBox(0.86, 0.08, 1.7,  color, 0, 0.22,  0));    // ãƒãƒƒãƒˆãƒ¬ã‚¹
  g.add(wBox(0.86, 0.08, 0.28, color, 0, 0.28, -0.72)); // æ•
  g.add(wBox(0.9,  0.35, 0.06, color, 0, 0.27,  0.97)); // ãƒ˜ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰
  g.position.set(x, y, z);
  return g;
}


/* ============================================================
   5. å„éšã®å®¶å…·ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
   å¼•æ•° yï¼šãã®éšã®ãƒ•ãƒ­ã‚¢Yåº§æ¨™ï¼ˆ(éšæ•°-1) Ã— FHï¼‰
   å®¶å…·ã¯ã™ã¹ã¦ b = y + 0.01 ï¼ˆãƒ•ãƒ­ã‚¢ã‚¹ãƒ©ãƒ–ã®å°‘ã—ä¸Šï¼‰ã«é…ç½®
============================================================ */

/** 1Fï¼šLANTANA é£Ÿå ‚ ï¼ ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰ï¼ˆã‚ªãƒ¼ãƒ—ãƒ³ãªãƒ•ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆå½¢å¼ï¼‰ */
function buildFurniture1F(y) {
  const g = new THREE.Group();
  const c = floorColors[1];
  const b = y + 0.01; // ãƒ•ãƒ­ã‚¢åºŠé¢

  // é£Ÿå ‚ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆå·¦å¥¥ï¼‰
  g.add(makeCounter(c, -1.8, b, -1.1));
  g.add(makeCoffeeMachine(c, -2.4, b + 0.86, -1.3)); // èª¿ç†æ©Ÿå™¨

  // ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰ï¼ˆå³å¥¥ï¼‰
  g.add(wBox(1.4, 0.85, 0.45, c,  1.6, b + 0.425, -1.1)); // ã‚¹ã‚¿ãƒ³ãƒ‰æœ¬ä½“
  g.add(wBox(1.4, 0.04, 0.55, c,  1.6, b + 0.86,  -1.1)); // å¤©æ¿
  g.add(makeCoffeeMachine(c,  1.1, b + 0.86, -1.3));        // ãƒã‚·ãƒ³Ã—2
  g.add(makeCoffeeMachine(c,  1.9, b + 0.86, -1.3));

  // å…±ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼†æ¤…å­ï¼ˆä¸­å¤®ã€œæ‰‹å‰ã«ãƒ•ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆé¢¨ã«é…ç½®ï¼‰
  [[-1.5, 0.2], [-1.5, 1.1],
   [ 0.0, 0.2], [ 0.0, 1.1],
   [ 1.5, 0.2], [ 1.5, 1.1]].forEach(([tx, tz]) => {
    g.add(makeTable(c, tx, b, tz));
    g.add(makeChair(c, tx - 0.5, b, tz,  0));            // å·¦
    g.add(makeChair(c, tx + 0.5, b, tz,  Math.PI));      // å³
    g.add(makeChair(c, tx, b, tz - 0.38,  Math.PI / 2)); // å¥¥
    g.add(makeChair(c, tx, b, tz + 0.38, -Math.PI / 2)); // æ‰‹å‰
  });

  // è¦³è‘‰æ¤ç‰©ï¼ˆå·¦å³ã‚³ãƒ¼ãƒŠãƒ¼ï¼‰
  g.add(makePlant(c, -2.8, b,  1.4));
  g.add(makePlant(c,  2.8, b,  1.4));

  // äººç‰©ï¼ˆã‚¹ã‚¿ãƒƒãƒ•2åï¼‹å®¢3åï¼‰
  g.add(makePerson(c, -1.7, b, -0.5)); // é£Ÿå ‚ã‚¹ã‚¿ãƒƒãƒ•
  g.add(makePerson(c,  1.5, b, -0.5)); // ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¹ã‚¿ãƒƒãƒ•
  g.add(makePerson(c, -1.2, b,  0.5)); // å®¢
  g.add(makePerson(c,  0.2, b,  0.8)); // å®¢
  g.add(makePerson(c,  1.3, b,  1.2)); // å®¢

  return g;
}

/** 2Fï¼šã‚«ãƒ—ã‚»ãƒ«ãƒ›ãƒ†ãƒ«ï¼ˆ12åï¼‰â€” å—ä»˜ãƒ»ã‚«ãƒ—ã‚»ãƒ«ãƒ™ãƒƒãƒ‰6å®¤ãƒ»æ´—æ¿¯æ©Ÿ */
function buildFurniture2F(y) {
  const g = new THREE.Group();
  const c = floorColors[2];
  const b = y + 0.01;

  // å—ä»˜ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆå³å¥¥ï¼‰
  g.add(makeCounter(c, 1.8, b, -1.2));
  g.add(makePerson(c, 1.6, b, -0.7)); // å—ä»˜ã‚¹ã‚¿ãƒƒãƒ•

  // ã‚«ãƒ—ã‚»ãƒ«ãƒ™ãƒƒãƒ‰ï¼š2åˆ— Ã— 3å®¤ = 6å®¤
  for (let row = 0; row < 2; row++) {
    for (let col = 0; col < 3; col++) {
      g.add(makeCapsuleBed(c, -2.4 + col * 0.95, b, -1.2 + row * 0.65));
    }
  }

  g.add(makeWasher(c, 2.0, b,  0.8)); // ãƒ©ãƒ³ãƒ‰ãƒªãƒ¼
  g.add(makePlant(c,  2.5, b, -1.5)); // è¦³è‘‰æ¤ç‰©

  return g;
}

/** 3Fï¼šã‚«ãƒ—ã‚»ãƒ«ãƒ›ãƒ†ãƒ«ï¼ˆ28åï¼‰â€” ã‚«ãƒ—ã‚»ãƒ«ãƒ™ãƒƒãƒ‰12å®¤ãƒ»æ´—æ¿¯æ©ŸÃ—2 */
function buildFurniture3F(y) {
  const g = new THREE.Group();
  const c = floorColors[3];
  const b = y + 0.01;

  // ã‚«ãƒ—ã‚»ãƒ«ãƒ™ãƒƒãƒ‰ï¼š3åˆ— Ã— 4å®¤ = 12å®¤
  for (let row = 0; row < 3; row++) {
    for (let col = 0; col < 4; col++) {
      g.add(makeCapsuleBed(c, -2.8 + col * 0.95, b, -1.3 + row * 0.65));
    }
  }

  // ãƒ©ãƒ³ãƒ‰ãƒªãƒ¼ã‚³ãƒ¼ãƒŠãƒ¼ï¼ˆæ´—æ¿¯æ©ŸÃ—2ï¼‰
  g.add(makeWasher(c,  2.0, b, -1.0));
  g.add(makeWasher(c,  2.5, b, -1.0));
  g.add(makePlant(c,   2.8, b,  0.5));

  // äººç‰©ï¼ˆå®¿æ³Šå®¢2åï¼‰
  g.add(makePerson(c, -1.5, b, 1.3));
  g.add(makePerson(c,  0.3, b, 1.3));

  return g;
}

/** 4Fï¼šLANTANA STUDY ROOM â€” è‡ªç¿’ãƒ‡ã‚¹ã‚¯8å°ãƒ»æœ¬æ£šãƒ»ã‚½ãƒ•ã‚¡ãƒ©ã‚¦ãƒ³ã‚¸ */
function buildFurniture4F(y) {
  const g = new THREE.Group();
  const c = floorColors[4];
  const b = y + 0.01;

  // æœ¬æ£šï¼ˆå¥¥å·¦å´ã«2å°ï¼‰
  g.add(makeBookshelf(c, -2.5, b, -1.4));
  g.add(makeBookshelf(c, -1.3, b, -1.4));

  // è‡ªç¿’ãƒ‡ã‚¹ã‚¯ï¼š2åˆ— Ã— 4å° = 8å°
  [[-1.8, -0.4], [-0.6, -0.4], [0.6, -0.4], [1.8, -0.4],
   [-1.8,  0.6], [-0.6,  0.6], [0.6,  0.6], [1.8,  0.6]].forEach(([dx, dz]) => {
    g.add(makeDesk(c, dx, b, dz));
    g.add(makeChair(c, dx, b, dz + 0.4, Math.PI)); // æ¤…å­ï¼ˆæ‰‹å‰å‘ãï¼‰
    g.add(makeLaptop(c, dx, b + 0.34, dz - 0.04)); // ãƒãƒ¼ãƒˆPC
  });

  // å‹‰å¼·ä¸­ã®äººç‰©ï¼ˆ3åï¼‰
  g.add(makePerson(c, -1.8, b, 0.7));
  g.add(makePerson(c, -0.6, b, 0.7));
  g.add(makePerson(c,  0.6, b, 0.7));

  // ä¼‘æ†©ãƒ©ã‚¦ãƒ³ã‚¸ï¼ˆå³å¥¥ï¼šã‚½ãƒ•ã‚¡ï¼‹æ¤ç‰©ï¼‰
  g.add(makeSofa(c,  2.5, b,  0.2));
  g.add(makePlant(c, 3.0, b, -1.2));

  return g;
}

/** 5Fï¼šLANTANA RESIDENCE â€” 2å®¤æ§‹æˆï¼ˆãƒ™ãƒƒãƒ‰ãƒ»ã‚½ãƒ•ã‚¡ãƒ»ãƒ‡ã‚¹ã‚¯ãƒ»é–“ä»•åˆ‡ã‚Šå£ï¼‰ */
function buildFurniture5F(y) {
  const g = new THREE.Group();
  const c = floorColors[5];
  const b = y + 0.01;

  // é–“ä»•åˆ‡ã‚Šå£ï¼ˆç¸¦æ–¹å‘ï¼šRoom1 ã¨ Room2 ã‚’åˆ†å‰²ï¼‰
  const wallH = FH * 0.85; // å¤©äº•ã®85%ã®é«˜ã•
  g.add(wBox(0.06, wallH, D * 0.9, c, -0.35, b + wallH / 2, -D * 0.05, 0.6));
  // å»Šä¸‹å´ã®æ¨ªä»•åˆ‡ã‚Šï¼ˆå„å®¤ã®å…¥å£å´ï¼‰
  g.add(wBox(W * 0.28, wallH, 0.06, c, -1.6, b + wallH / 2, D * 0.35, 0.6));
  g.add(wBox(W * 0.28, wallH, 0.06, c,  0.95, b + wallH / 2, D * 0.35, 0.6));

  // Room 1ï¼ˆå·¦å´ï¼‰
  g.add(makeSofa(c,   -2.2, b,  0.3));
  g.add(makeDesk(c,   -2.2, b, -0.8));
  g.add(makeChair(c,  -2.2, b, -0.4, Math.PI));
  g.add(makePlant(c,  -1.2, b, -1.3));
  g.add(makeBed(c,    -2.8, b, -0.1));

  // Room 2ï¼ˆå³å´ï¼‰
  g.add(makeSofa(c,   0.8, b,  0.3));
  g.add(makeDesk(c,   0.8, b, -0.8));
  g.add(makeChair(c,  0.8, b, -0.4, Math.PI));
  g.add(makePlant(c,  1.8, b, -1.3));
  g.add(makeBed(c,    1.6, b, -0.1));

  // äººç‰©ï¼ˆå„å®¤1åï¼‰
  g.add(makePerson(c, -2.5, b, 0.8));
  g.add(makePerson(c,  1.0, b, 0.8));

  return g;
}


/* ============================================================
   6. ãƒ•ãƒ­ã‚¢æœ¬ä½“ï¼ˆãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒœãƒƒã‚¯ã‚¹ï¼‹ã‚¹ãƒ©ãƒ–ï¼‹ãƒ©ãƒ™ãƒ«ï¼‰ã®ç”Ÿæˆ
   1ã€œ5Fã‚’ãƒ«ãƒ¼ãƒ—ã§ç”Ÿæˆã—ã€floorGroups / furnitureGroups ã«æ ¼ç´
============================================================ */
for (let f = 1; f <= 5; f++) {
  const group = new THREE.Group();
  const y        = (f - 1) * FH; // ã“ã®ãƒ•ãƒ­ã‚¢ã®åº•é¢Yåº§æ¨™
  const col      = floorColors[f];
  const colLight = floorColorsLight[f];

  // ä¸»æ£Ÿã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒœãƒƒã‚¯ã‚¹
  group.add(wireBox(W, FH, D, col, 0, y + FH / 2, 0, 0.45));

  // 1ã€œ3Fã®ã¿ã‚¢ãƒãƒƒã‚¯ã‚¹ï¼ˆå¢—ç¯‰éƒ¨ï¼‰ã‚’è¿½åŠ 
  if (f <= 3) {
    const annexX = W / 2 + AW / 2;
    group.add(wireBox(AW, FH, AD, col, annexX, y + FH / 2, D / 2 - AD / 2, 0.45));
  }

  // ãƒ•ãƒ­ã‚¢ã‚¹ãƒ©ãƒ–ï¼ˆåºŠé¢ã®è–„ã„å¡—ã‚Šé¢ï¼‰
  const slabGeo = new THREE.PlaneGeometry(W, D);
  const slabMat = new THREE.MeshBasicMaterial({
    color: colLight, transparent: true, opacity: 0.18, side: THREE.DoubleSide
  });
  const slab = new THREE.Mesh(slabGeo, slabMat);
  slab.rotation.x = -Math.PI / 2; // æ°´å¹³ã«
  slab.position.set(0, y + 0.01, 0);
  group.add(slab);

  // ãƒ•ãƒ­ã‚¢ãƒ©ãƒ™ãƒ«ï¼ˆéšæ•°ï¼‹æ–½è¨­åã®ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆï¼‰
  // CanvasTexture ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»ã— Sprite ã§3Dç©ºé–“ã«è¡¨ç¤º
  const lc = document.createElement('canvas');
  lc.width = 256; lc.height = 128;
  const ctx = lc.getContext('2d');
  ctx.font      = 'bold 48px monospace';
  ctx.fillStyle = '#' + col.toString(16).padStart(6, '0');
  ctx.fillText(f + 'F', 10, 56);
  const names = ['LANTANA é£Ÿå ‚', 'CAPSULE HOTEL', 'CAPSULE HOTEL', 'STUDY ROOM', 'RESIDENCE'];
  ctx.font      = '22px sans-serif';
  ctx.fillStyle = '#1a0f08';
  ctx.fillText(names[f - 1], 10, 90);
  const spriteMat = new THREE.SpriteMaterial({ map: new THREE.CanvasTexture(lc), transparent: true });
  const sprite    = new THREE.Sprite(spriteMat);
  sprite.scale.set(8, 4, 1);
  sprite.position.set(-W / 2 - 4.5, y + FH / 2, 0); // å»ºç‰©å·¦å´ã«é…ç½®
  group.add(sprite);

  floorGroups[f] = group;
  scene.add(group);

  // å®¶å…·ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç”Ÿæˆã—ã¦ã‚·ãƒ¼ãƒ³ã«è¿½åŠ 
  const furn = [null,
    buildFurniture1F(y),
    buildFurniture2F(y),
    buildFurniture3F(y),
    buildFurniture4F(y),
    buildFurniture5F(y)
  ][f];
  furnitureGroups[f] = furn;
  scene.add(furn);
}

// ã‚°ãƒªãƒƒãƒ‰ï¼ˆåœ°é¢ã®è£œåŠ©ç·šï¼‰
const gridHelper = new THREE.GridHelper(60, 30, 0xa89880, 0xc8bfb0);
scene.add(gridHelper);


/* ============================================================
   7. ã‚°ãƒ­ãƒ¼ç”¨ã‚·ãƒ¼ãƒ³ç”Ÿæˆ
   ãƒ¡ã‚¤ãƒ³ã‚·ãƒ¼ãƒ³ã¨ã¯åˆ¥ã« glowScene ã‚’ç”¨æ„ã—ã€
   é¸æŠéšã®å¤–å½¢ãƒ©ã‚¤ãƒ³ã ã‘ã‚’æ˜ã‚‹ã„è‰²ã§æç”»ã™ã‚‹
   â†’ glowRenderer ã§ glowCanvas ã«æç”»å¾Œã€CSS blur/brightness ã§ã‚°ãƒ­ãƒ¼æ¼”å‡º
============================================================ */
const glowScene  = new THREE.Scene();
const glowGroups = {};

for (let f = 1; f <= 5; f++) {
  const yBase = (f - 1) * FH;
  const gc    = floorGlowColors[f]; // ã“ã®éšã®ã‚°ãƒ­ãƒ¼è‰²
  const gg    = new THREE.Group();

  // ã‚°ãƒ­ãƒ¼ãƒœãƒƒã‚¯ã‚¹ã‚’ç”Ÿæˆã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°
  function glowBox(w, h, d, x, y, z) {
    const m = new THREE.LineSegments(
      new THREE.EdgesGeometry(new THREE.BoxGeometry(w, h, d)),
      new THREE.LineBasicMaterial({ color: gc, transparent: true, opacity: 1.0 })
    );
    m.position.set(x, y, z);
    return m;
  }

  // ä¸»æ£Ÿã®å¤–å½¢ã‚¨ãƒƒã‚¸
  gg.add(glowBox(W, FH, D, 0, yBase + FH / 2, 0));
  // 1ã€œ3Fï¼šã‚¢ãƒãƒƒã‚¯ã‚¹ã®å¤–å½¢ã‚¨ãƒƒã‚¸
  if (f <= 3) {
    const annexX = W / 2 + AW / 2;
    gg.add(glowBox(AW, FH, AD, annexX, yBase + FH / 2, D / 2 - AD / 2));
  }
  // ãƒ•ãƒ­ã‚¢ã‚¹ãƒ©ãƒ–ã®ã‚¨ãƒƒã‚¸ãƒ©ã‚¤ãƒ³
  gg.add(glowBox(W, 0.04, D, 0, yBase + 0.02, 0));

  gg.visible = false; // åˆæœŸã¯éè¡¨ç¤ºï¼ˆselectFloor ã§åˆ‡ã‚Šæ›¿ãˆï¼‰
  glowScene.add(gg);
  glowGroups[f] = gg;
}


/* ============================================================
   8. ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
   ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã¨ã‚«ãƒ¡ãƒ©ã‚’æ›´æ–°
============================================================ */
function resize() {
  const w = container.clientWidth;
  const h = container.clientHeight;
  renderer.setSize(w, h);
  glowRenderer.setSize(w, h);
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
}
resize();
window.addEventListener('resize', resize);


/* ============================================================
   9. ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒæ“ä½œ
   - ãƒã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°ï¼šrotX/rotY ã‚’å¤‰åŒ–ã•ã›ã¦ã‚«ãƒ¡ãƒ©å›è»¢
   - ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼šzoom ã‚’å¤‰åŒ–ã•ã›ã¦ã‚«ãƒ¡ãƒ©è·é›¢èª¿æ•´
   - ã‚¿ãƒƒãƒ1æœ¬ï¼šãƒ‰ãƒ©ãƒƒã‚°å›è»¢ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
   - ã‚¿ãƒƒãƒ2æœ¬ï¼šãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
============================================================ */
let isDragging = false, prevX = 0, prevY = 0;
let autoRotate = true;                        // è‡ªå‹•å›è»¢ãƒ•ãƒ©ã‚°
let rotX = 0.3, rotY = 0.5, zoom = 55;       // ã‚«ãƒ¡ãƒ©ç¾åœ¨å€¤
const target = new THREE.Vector3(0, 4.375, 0); // ã‚«ãƒ¡ãƒ©æ³¨è¦–ç‚¹

// ãƒã‚¦ã‚¹
canvas.addEventListener('mousedown', e => { isDragging = true; prevX = e.clientX; prevY = e.clientY; });
window.addEventListener('mouseup', () => isDragging = false);
window.addEventListener('mousemove', e => {
  if (!isDragging) return;
  rotY += (e.clientX - prevX) * 0.01;
  rotX += (e.clientY - prevY) * 0.01;
  rotX   = Math.max(-1.2, Math.min(1.2, rotX)); // ä»°è§’ã‚’ä¸Šä¸‹ã«åˆ¶é™
  prevX  = e.clientX;
  prevY  = e.clientY;
});
canvas.addEventListener('wheel', e => {
  zoom = Math.max(10, Math.min(120, zoom + e.deltaY * 0.05)); // 10ã€œ120ã®ç¯„å›²ã§åˆ¶é™
});

// ã‚¿ãƒƒãƒï¼ˆã‚¹ãƒãƒ›ï¼‰
canvas.addEventListener('touchstart', e => {
  if (e.touches.length === 1) {
    isDragging = true;
    prevX = e.touches[0].clientX;
    prevY = e.touches[0].clientY;
  }
}, { passive: true });
canvas.addEventListener('touchend', () => isDragging = false);
canvas.addEventListener('touchmove', e => {
  if (e.touches.length === 1 && isDragging) {
    // 1æœ¬æŒ‡ï¼šå›è»¢
    rotY += (e.touches[0].clientX - prevX) * 0.01;
    rotX += (e.touches[0].clientY - prevY) * 0.01;
    rotX  = Math.max(-1.2, Math.min(1.2, rotX));
    prevX = e.touches[0].clientX;
    prevY = e.touches[0].clientY;
  } else if (e.touches.length === 2) {
    // 2æœ¬æŒ‡ï¼šãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼ˆæŒ‡é–“è·é›¢ã®å¤‰åŒ–é‡ã§zoomã‚’å¤‰ãˆã‚‹ï¼‰
    const dx   = e.touches[0].clientX - e.touches[1].clientX;
    const dy   = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (canvas._pinchDist) {
      zoom = Math.max(10, Math.min(120, zoom - (dist - canvas._pinchDist) * 0.15));
    }
    canvas._pinchDist = dist;
  }
}, { passive: true });
canvas.addEventListener('touchend', () => { canvas._pinchDist = null; isDragging = false; });


/* ============================================================
   10. ãƒ•ãƒ­ã‚¢é¸æŠ
   - ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å‘¼ã°ã‚Œã‚‹
   - ã‚«ãƒ¡ãƒ©ã‚’ãã®éšã®é«˜ã•ã«ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ï¼ˆtargetZoom/targetCamY ã‚’æ›´æ–°ï¼‰
   - ã‚°ãƒ­ãƒ¼canvasã®ç™ºå…‰è‰²ã‚’éšã«åˆã‚ã›ã¦åˆ‡ã‚Šæ›¿ãˆ
   - updateVisibility() ã§ãƒ¯ã‚¤ãƒ¤ãƒ¼ã®è‰²è¡¨ç¤ºã‚’æ›´æ–°
============================================================ */

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è£œé–“ç”¨ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå€¤ï¼ˆanimateå†…ã§ç¾åœ¨å€¤ã‚’lerpã§è¿‘ã¥ã‘ã‚‹ï¼‰
let targetZoom = 55;
let targetRotX = 0.3;
let targetCamY = 4.375; // target.y ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å…ˆ

window.selectFloor = function(f) {
  // â”€â”€ å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€
  // æ•´æ•°ã«å¤‰æ›ã—ã€æœ‰åŠ¹ãªéšç•ªå·ï¼ˆ1ã€œ5ï¼‰ä»¥å¤–ã¯å‡¦ç†ã—ãªã„
  f = parseInt(f, 10);
  if (!Number.isInteger(f) || f < 1 || f > 5) return;

  selectedFloor = f;

  // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
  document.querySelectorAll('.floor-card').forEach(el => el.classList.remove('active'));
  document.querySelector(`[data-floor="${f}"]`).classList.add('active');

  // ãã®éšã®ä¸­å¿ƒYåº§æ¨™ã‚’è¨ˆç®—ã—ã¦ã‚«ãƒ¡ãƒ©ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è¨­å®š
  const floorCenterY = (f - 1) * FH + FH / 2;
  targetCamY = floorCenterY;
  targetZoom = 22;   // å…¨ä½“è¡¨ç¤º(55)â†’é¸æŠéšã‚ºãƒ¼ãƒ (22)
  targetRotX = 0.28; // å°‘ã—è¦‹ä¸‹ã‚ã™è§’åº¦

  // ã‚°ãƒ­ãƒ¼canvasã®å¤–æ ã‚«ãƒ©ãƒ¼ã‚’éšã®ç™ºå…‰è‰²ã«å¤‰æ›´
  const glowHex = '#' + floorGlowColors[f].toString(16).padStart(6, '0');
  glowCanvas.style.boxShadow = `0 0 40px 10px ${glowHex}`;

  updateVisibility();
};


/* ============================================================
   11. è¡¨ç¤ºåˆ‡æ›¿ï¼ˆé¸æŠéšï¼šãƒ•ãƒ­ã‚¢ã‚«ãƒ©ãƒ¼ã€éé¸æŠï¼šã‚°ãƒ¬ãƒ¼ï¼‰
   ãƒ•ãƒ­ã‚¢ã‚°ãƒ«ãƒ¼ãƒ—ã®å„ãƒãƒ†ãƒªã‚¢ãƒ«ã® color ã¨ opacity ã‚’æ›´æ–°ã™ã‚‹
   - wireframeï¼ˆwireBoxã§ç”Ÿæˆï¼‰ã¨ isLineSegmentsï¼ˆwBoxã§ç”Ÿæˆï¼‰ã§è­˜åˆ¥
============================================================ */
function updateVisibility() {
  for (let f = 1; f <= 5; f++) {
    const isActive    = f === selectedFloor;
    const activeColor = new THREE.Color(floorColors[f]);
    const activeSlab  = new THREE.Color(floorColorsLight[f]);

    floorGroups[f].children.forEach(child => {
      if (!child.material) return;

      if (child.material.wireframe) {
        // wireBoxï¼ˆMeshBasicMaterial.wireframeï¼‰ã®å ´åˆ
        child.material.color.set(isActive ? activeColor : GRAY);
        child.material.opacity = isActive ? 1 : 0.35;
      } else if (child.isLineSegments) {
        // wBox / wCylï¼ˆLineSegmentsï¼‰ã®å ´åˆ
        child.material.color.set(isActive ? activeColor : GRAY);
        child.material.opacity = isActive ? 1 : 0.35;
      } else if (child.material.transparent) {
        // ãƒ•ãƒ­ã‚¢ã‚¹ãƒ©ãƒ–ï¼ˆPlaneGeometryï¼‰ã®å ´åˆ
        child.material.color.set(isActive ? activeSlab : GRAY_SLAB);
        child.material.opacity = isActive ? 0.3 : 0.06;
      }
    });

    // å®¶å…·ã¯é¸æŠéšã®ã¿è¡¨ç¤º
    furnitureGroups[f].visible = isActive;
  }
}


/* ============================================================
   12. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
   requestAnimationFrame ã§æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œ
   - ã‚«ãƒ¡ãƒ©ä½ç½®ï¼šlerpï¼ˆç·šå½¢è£œé–“ï¼‰ã§ã‚¹ãƒ ãƒ¼ã‚ºã«ç›®æ¨™å€¤ã¸è¿‘ã¥ã‘ã‚‹
   - è‡ªå‹•å›è»¢ï¼šautoRotate ãŒ true ã®ã¨ã rotY ã‚’ã‚†ã£ãã‚Šå¢—åŠ 
   - é¸æŠéšã®ç‚¹æ»…ï¼šsinæ³¢ã§ opacity ã‚’ 0.1ã€œ1.0 ã«å¤‰åŒ–ã•ã›ã‚‹
   - ã‚°ãƒ­ãƒ¼passï¼šglowScene ã‚’åˆ¥ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã§æç”»ã€CSSãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã§ã¼ã‹ã™
============================================================ */
let time = 0;
function animate() {
  requestAnimationFrame(animate);
  time += 0.016; // ç´„60fpsæƒ³å®šã®ãƒ•ãƒ¬ãƒ¼ãƒ æ™‚é–“

  // ã‚«ãƒ¡ãƒ©å€¤ã‚’ç›®æ¨™å€¤ã«å‘ã‘ã¦è£œé–“ï¼ˆease = è¿‘ã¥ãå‰²åˆã€å°ã•ã„ã»ã©ã‚†ã£ãã‚Šï¼‰
  const ease = 0.08;
  zoom     += (targetZoom - zoom)     * ease;
  rotX     += (targetRotX - rotX)     * ease;
  target.y += (targetCamY - target.y) * ease;

  // è‡ªå‹•å›è»¢ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ä¸­ã¯åœæ­¢ï¼‰
  if (!isDragging && autoRotate) rotY += 0.003;

  // çƒé¢åº§æ¨™ã§ã‚«ãƒ¡ãƒ©ä½ç½®ã‚’è¨ˆç®—ï¼ˆtarget ã‚’ä¸­å¿ƒã« zoom ã®è·é›¢ã§å‘¨å›ï¼‰
  camera.position.x = target.x + zoom * Math.sin(rotY) * Math.cos(rotX);
  camera.position.y = target.y + zoom * Math.sin(rotX);
  camera.position.z = target.z + zoom * Math.cos(rotY) * Math.cos(rotX);
  camera.lookAt(target);

  // é¸æŠéšã®ãƒ¯ã‚¤ãƒ¤ãƒ¼ã‚’ sin æ³¢ã§ç‚¹æ»…ï¼ˆ0.55ã€œ1.0 ã®ç¯„å›²ï¼‰
  const pulse = 0.55 + 0.45 * Math.sin(time * 4.5);
  floorGroups[selectedFloor].children.forEach(child => {
    if (!child.material) return;
    if (child.material.wireframe || child.isLineSegments)
      child.material.opacity = pulse;
  });

  // ã‚°ãƒ­ãƒ¼passï¼šé¸æŠéšã® glowGroup ã®ã¿è¡¨ç¤ºã—ã€pulse ã«åˆã‚ã›ã¦ opacity ã‚’å¤‰åŒ–
  for (let f = 1; f <= 5; f++) {
    glowGroups[f].visible = (f === selectedFloor);
    if (f === selectedFloor) {
      glowGroups[f].children.forEach(c => {
        if (c.material) c.material.opacity = pulse;
      });
    }
  }

  // CSS filter ã§ glowCanvas ã‚’ã¼ã‹ã—ã¦å…‰ã‚‰ã›ã‚‹
  // blurPxï¼šã¼ã‹ã—åŠå¾„ï¼ˆpulse ã«é€£å‹•ã—ã¦ 4ã€œ10px ã§å¤‰åŒ–ï¼‰
  // brightï¼šæ˜ã‚‹ã•å€ç‡ï¼ˆ1.0ã€œ2.2 ã§å¤‰åŒ–ï¼‰
  const blurPx = (4 + 6 * pulse).toFixed(1);
  const bright = (1 + 1.2 * pulse).toFixed(2);
  glowCanvas.style.filter  = `blur(${blurPx}px) brightness(${bright})`;
  glowCanvas.style.opacity = (0.5 + 0.5 * pulse).toFixed(2);

  // ãƒ¡ã‚¤ãƒ³ã‚·ãƒ¼ãƒ³ã‚’æç”»
  renderer.render(scene, camera);
  // ã‚°ãƒ­ãƒ¼ã‚·ãƒ¼ãƒ³ã‚’ glowCanvas ã«æç”»ï¼ˆé‡ã­åˆã‚ã›ï¼‰
  glowRenderer.render(glowScene, camera);
}

updateVisibility();
animate();


/* ============================================================
   13. æ“ä½œãƒœã‚¿ãƒ³
   holdBtnï¼šæŠ¼ã—ç¶šã‘ã‚‹ã¨ setInterval ã§é€£ç¶šå®Ÿè¡Œã™ã‚‹æ±ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼
   å„ãƒœã‚¿ãƒ³ã« holdBtn ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã™ã‚‹
============================================================ */

/**
 * ãƒœã‚¿ãƒ³ã®æŠ¼ã—ç¶šã‘å‹•ä½œã‚’ç™»éŒ²ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
 * ã‚¯ãƒªãƒƒã‚¯1å› â†’ 1å›å®Ÿè¡Œã€æŠ¼ã—ç¶šã‘ â†’ 60msã”ã¨ã«ç¹°ã‚Šè¿”ã—å®Ÿè¡Œ
 */
function holdBtn(id, action) {
  let timer;
  const el = document.getElementById(id);
  if (!el) return;
  const start = () => { action(); timer = setInterval(action, 60); };
  const stop  = () => clearInterval(timer);
  el.addEventListener('mousedown',  start);
  el.addEventListener('touchstart', start, { passive: true });
  el.addEventListener('mouseup',    stop);
  el.addEventListener('mouseleave', stop);
  el.addEventListener('touchend',   stop);
}

// ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ãƒ»ã‚¢ã‚¦ãƒˆï¼ˆtargetZoom ã‚’æ›´æ–° â†’ animate ã§è£œé–“ï¼‰
holdBtn('btn-zoom-in',    () => { targetZoom = Math.max(8,   targetZoom - 1.5); zoom = targetZoom; });
holdBtn('btn-zoom-out',   () => { targetZoom = Math.min(120, targetZoom + 1.5); zoom = targetZoom; });

// å›è»¢ï¼ˆrotY/targetRotX ã‚’ç›´æ¥å¤‰æ›´ï¼‰
holdBtn('btn-rot-left',   () => { rotY -= 0.04; });
holdBtn('btn-rot-right',  () => { rotY += 0.04; });
holdBtn('btn-rot-up',     () => { targetRotX = Math.max(-1.2, targetRotX - 0.03); });
holdBtn('btn-rot-down',   () => { targetRotX = Math.min(1.2,  targetRotX + 0.03); });

// ãƒªã‚»ãƒƒãƒˆï¼šå…¨ä½“ä¿¯ç°ã®åˆæœŸè¦–ç‚¹ã«æˆ»ã™
document.getElementById('btn-reset').addEventListener('click', () => {
  targetZoom = 55; targetRotX = 0.3; targetCamY = 4.375;
  rotY = 0.5;
});

// è‡ªå‹•å›è»¢ãƒˆã‚°ãƒ«ï¼šâ–¶ï¼ˆå›è»¢ä¸­ï¼‰â†” â€–ï¼ˆåœæ­¢ä¸­ï¼‰ã‚’SVG DOMã§åˆ‡ã‚Šæ›¿ãˆ
// innerHTML ã‚’ä½¿ã‚ãš createElementNS ã§å®‰å…¨ã«SVGè¦ç´ ã‚’ç”Ÿæˆã™ã‚‹
const btnAutoRot  = document.getElementById('btn-autorot');
const autorotIcon = document.getElementById('autorot-icon');
const SVG_NS      = 'http://www.w3.org/2000/svg';

function setAutorotIcon(isPlaying) {
  // æ—¢å­˜ã®å­è¦ç´ ã‚’å…¨å‰Šé™¤
  while (autorotIcon.firstChild) autorotIcon.removeChild(autorotIcon.firstChild);

  if (isPlaying) {
    // å†ç”Ÿã‚¢ã‚¤ã‚³ãƒ³ï¼ˆä¸‰è§’å½¢ï¼‰
    const poly = document.createElementNS(SVG_NS, 'polygon');
    poly.setAttribute('points', '3,2 13,8 3,14');
    autorotIcon.appendChild(poly);
  } else {
    // ä¸€æ™‚åœæ­¢ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆç¸¦æ£’2æœ¬ï¼‰
    const r1 = document.createElementNS(SVG_NS, 'rect');
    r1.setAttribute('x', '3'); r1.setAttribute('y', '2');
    r1.setAttribute('width', '3.5'); r1.setAttribute('height', '12');
    const r2 = document.createElementNS(SVG_NS, 'rect');
    r2.setAttribute('x', '9.5'); r2.setAttribute('y', '2');
    r2.setAttribute('width', '3.5'); r2.setAttribute('height', '12');
    autorotIcon.appendChild(r1);
    autorotIcon.appendChild(r2);
  }
}

btnAutoRot.addEventListener('click', () => {
  autoRotate = !autoRotate;
  setAutorotIcon(autoRotate);
  btnAutoRot.classList.toggle('active-toggle', autoRotate);
});
</script>
</script>
</body>
</html>
